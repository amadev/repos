#!/usr/bin/env joker
;; #-*- mode: clojure -*-

(ns script
    (:require [joker.tools.cli :as cli]
              [joker.os :as os]
              [src.repos.core :as r]))

(defn main
  []
  (let [env (os/env)
        db-path (get env "REPOS_DB" "$HOME/.repos/db.yaml")
        db (r/read-yaml (r/expand-env (os/env) db-path))]
    (r/pull-all (:repos db))))

(try
  (main)
  (catch Error e
    (printf "Error: %s\nCause: %s\nSee log for details\n"
            (ex-message e)
            (:cause (ex-data e)))))
